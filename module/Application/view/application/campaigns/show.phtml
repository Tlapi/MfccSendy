<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA99QyIf2spNs00Nb5vrJUu0KMTo-k4_vw&sensor=false">
</script>

<div class="well">
	Note: this is demo report for campaign with tag: <strong>pardal</strong>
</div>

<div class="well">
	TODO: share capmaign (CM), View (CM)
</div>

<h1>Campaign report <?php echo $this->campaignStatus($this->campaign->status)?></h1>

Sent to <span class="label"><?php echo $this->stats['info']['sent']?> subscribers</span>
<br />
Reputation for this campaign: <?php echo $this->stats['info']['reputation']?>

<br /><br />

<div class="well">
	<span class="label"><?php echo $this->stats['info']['opens']?></span> opened (<?php echo $this->stats['info']['unique_opens']?> unique)
	<br /><br />
	<span class="label"><?php echo $this->stats['info']['sent'] - $this->stats['info']['unique_opens']?></span> not opened
	<br /><br />
	<span class="label"><?php echo $this->stats['info']['clicks']?></span> clicked a link (<?php echo $this->stats['info']['unique_clicks']?> unique)
	<br /><br />
	<span class="label"></span> unsubscribed (TODO)
	<br /><br />
	<span class="label"><?php echo $this->stats['info']['hard_bounces'] + $this->stats['info']['soft_bounces']?></span> bounced (<?php echo $this->stats['info']['hard_bounces']?> hard, <?php echo $this->stats['info']['soft_bounces']?> soft)
	<br /><br />
	<span class="label"><?php echo $this->stats['info']['complaints']?></span> marked as spam
</div>

<br /><br />

<h4>Link activity</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->getLastClicked() as $row){?>
  			<tr>
  				<td><b><?php echo $row->email?></b></td>
  				<td><?php echo $row->occured_at->format('Y-m-d H:m:s')?></td>
  			</tr>
  			<?php }?>
  		</tbody>
</table>

<h4>Last 10 opened</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->getLastOpened() as $row){?>
  			<tr>
  				<td><b><?php echo $row->email?></b></td>
  				<td><?php echo $row->occured_at->format('Y-m-d H:m:s')?></td>
  			</tr>
  			<?php }?>
  		</tbody>
</table>

<h4>Last 10 unsubscribed (todo)</h4>

<h4>Last 10 bounced</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->getLastBounced() as $row){?>
  			<tr>
  				<td><b><?php echo $row->email?></b></td>
  				<td><b><?php echo $row->event?></b></td>
  				<td><b><?php echo $row->msg?></b></td>
  				<td><?php echo $row->occured_at->format('Y-m-d H:m:s')?></td>
  			</tr>
  			<?php }?>
  		</tbody>
</table>

<h4>Last 10 marked as spam</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->getLastSpam() as $row){?>
  			<tr>
  				<td><b><?php echo $row->email?></b></td>
  				<td><?php echo $row->occured_at->format('Y-m-d H:m:s')?></td>
  			</tr>
  			<?php }?>
  		</tbody>
</table>

<h4>Live map</h4>

<div id="map-canvas" style="width: 100%; height: 600px"></div>

<h4>Countries /pie+table</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->location as $country => $regions){?>
  				<?php foreach($regions as $region => $counter){?>
	  			<tr>
	  				<td><b><?php echo $country?></b></td>
	  				<td><?php echo $region?></td>
	  				<td><?php echo $counter?></td>
	  			</tr>
  				<?php }?>
  			<?php }?>
  		</tbody>
</table>

<h4>Operation systems /pie+table</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->os as $family => $names){?>
  				<?php foreach($names as $name => $counter){?>
	  			<tr>
	  				<td><b><?php echo $family?></b></td>
	  				<td><?php echo $name?></td>
	  				<td><?php echo $counter?></td>
	  			</tr>
  				<?php }?>
  			<?php }?>
  		</tbody>
</table>

<h4>Clients /pie+table</h4>

<table class="table">
  		<tbody>
  			<?php foreach($this->campaign->ua as $family => $versions){?>
  				<?php foreach($versions as $version => $counter){?>
	  			<tr>
	  				<td><b><?php echo $family?></b></td>
	  				<td><?php echo $version?></td>
	  				<td><?php echo $counter?></td>
	  			</tr>
  				<?php }?>
  			<?php }?>
  		</tbody>
</table>

<h4>Mobile vs. Desktop /pie</h4>

<script src=http://cdn.pubnub.com/pubnub-3.5.3.1.min.js ></script>

<script>
$(document).ready(function () {
var mapOptions = {
		  center: new google.maps.LatLng(49.897, 16.144),
      zoom: 2,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

var map = new google.maps.Map(document.getElementById('map-canvas'),
		mapOptions);

var pubnub = PUBNUB.init({ subscribe_key : 'sub-677ba457-b147-11e1-b52f-a7abc5428a24' });

//LISTEN
pubnub.subscribe({
 channel : "mfcc_sender_event",
 message : function(m){
 	var obj = jQuery.parseJSON(m);
 	console.log(obj);
 	//alert(m);
 	var pos = new google.maps.LatLng(obj.latitude, obj.longitude);
 	var marker = new google.maps.Marker({
 	      position: pos,
 	      map: map
 	});
 }
});

});
</script>